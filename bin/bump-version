#!/bin/bash

set -e

if [ $# -ne 1 -o "$1" = '-h' -o "$1" = '--help' ]; then
    echo 'Usage: bump-version [-h|--help] <VERSION>' >&2
    exit 1
fi

agvtool new-version "${1%.*}"
agvtool new-marketing-version "$1"
ruby -pi -e "\$_.sub!(/[0-9]+[.][0-9]+[.][0-9]+/,'$1') if /spec[.]version *=/" ApolloDeveloperKit.podspec
ruby -pi -e "\$_.sub!(/[0-9]+[.][0-9]+[.][0-9]+/,'$1') if /pod 'ApolloDeveloperKit',/" README.md
npm version --no-git-tag-version "$1"
