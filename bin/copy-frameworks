#!/bin/bash

# Emulates carthage copy-frameworks without stripping.

set -e

mkdir -p "$BUILT_PRODUCTS_DIR/$FRAMEWORKS_FOLDER_PATH"

for ((i = 0; i < $SCRIPT_INPUT_FILE_COUNT; i++))
do
    input_path="$(eval printf \$SCRIPT_INPUT_FILE_$i)"
    input_base="$(basename "$input_path")"
    output_path="$BUILT_PRODUCTS_DIR/$FRAMEWORKS_FOLDER_PATH/$input_base"
    ditto "$input_path" "$output_path"
    if [ x"$CODE_SIGNING_ALLOWED" = x'YES' ]; then
        codesign --force --sign "$EXPANDED_CODE_SIGN_IDENTITY" --preserve-metadata=identifier,entitlements "$output_path"
    fi
done
